
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-12">
                <div class="card shadow">
                    <div class="card-header bg-warning text-dark">
                        <h2 class="text-center mb-0">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                    </div>
                    <div class="card-body">
                        <% if (requests.length === 0) { %>
                            <div class="alert alert-info text-center">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹
                            </div>
                        <% } else { %>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                                            <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨</th>
                                            <th>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% requests.forEach(request => { %>
                                        <tr>
                                            <td class="fw-bold text-primary"><%= request.request_id %></td>
                                            <td><%= request.name %></td>
                                            <td><%= request.department %></td>
                                            <td><%= request.request_type %></td>
                                            <td>
                                                <span class="badge 
                                                    <% if (request.priority === 'Ø·Ø§Ø±Ø¦Ø©') { %>bg-danger<% } 
                                                    else if (request.priority === 'Ø¹Ø§Ø¬Ù„Ø©') { %>bg-warning<% } 
                                                    else if (request.priority === 'Ù…ØªÙˆØ³Ø·Ø©') { %>bg-info<% } 
                                                    else { %>bg-secondary<% } %>">
                                                    <%= request.priority || 'Ø¹Ø§Ø¯ÙŠØ©' %>
                                                </span>
                                            </td>
                                            <td>
                                                <span class="badge 
                                                    <% if (request.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©') { %>bg-warning<% } 
                                                    else if (request.status === 'ØªØ­Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©') { %>bg-info<% } 
                                                    else if (request.status === 'Ù…Ù†Ø¬Ø²') { %>bg-success<% } 
                                                    else { %>bg-secondary<% } %>">
                                                    <%= request.status %>
                                                </span>
                                            </td>
                                            <td><%= new Date(request.created_at).toLocaleDateString('ar-SA') %></td>
                                            <td>
                                                <button class="btn btn-sm btn-outline-primary" 
                                                        onclick="showUpdateModal('<%= request.request_id %>', '<%= request.status %>', '<%= request.notes || '' %>')">
                                                    ØªØ­Ø¯ÙŠØ«
                                                </button>
                                                <button class="btn btn-sm btn-outline-info" 
                                                        onclick="showDetails('<%= JSON.stringify(request).replace(/"/g, '&quot;') %>')">
                                                    Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                                </button>
                                            </td>
                                        </tr>
                                        <% }); %>
                                    </tbody>
                                </table>
                            </div>
                        <% } %>
                    </div>
                </div>
                
                <div class="text-center mt-3">
                    <a href="/reports" class="btn btn-outline-success">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</a>
                    <a href="/" class="btn btn-outline-primary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© -->
    <div class="modal fade" id="updateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form action="/admin/update" method="POST">
                    <div class="modal-body">
                        <input type="hidden" id="updateRequestId" name="request_id">
                        
                        <div class="mb-3">
                            <label for="updateStatus" class="form-label">Ø§Ù„Ø­Ø§Ù„Ø©</label>
                            <select class="form-control" id="updateStatus" name="status" required>
                                <option value="Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</option>
                                <option value="ØªØ­Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©">ØªØ­Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</option>
                                <option value="Ù…Ù†Ø¬Ø²">Ù…Ù†Ø¬Ø²</option>
                                <option value="Ù…Ø±ÙÙˆØ¶">Ù…Ø±ÙÙˆØ¶</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="updateNotes" class="form-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <textarea class="form-control" id="updateNotes" name="notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥Ù„ØºØ§Ø¡</button>
                        <button type="submit" class="btn btn-primary">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨ -->
    <div class="modal fade" id="detailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="detailsContent">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function showUpdateModal(requestId, currentStatus, currentNotes) {
            document.getElementById('updateRequestId').value = requestId;
            document.getElementById('updateStatus').value = currentStatus;
            document.getElementById('updateNotes').value = currentNotes;
            
            var modal = new bootstrap.Modal(document.getElementById('updateModal'));
            modal.show();
        }
        
        function showDetails(requestData) {
            const request = JSON.parse(requestData.replace(/&quot;/g, '"'));
            const detailsContent = document.getElementById('detailsContent');
            
            detailsContent.innerHTML = `
                <div class="row">
                    <div class="col-md-6"><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${request.request_id}</div>
                    <div class="col-md-6"><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${request.name}</div>
                </div><hr>
                <div class="row">
                    <div class="col-md-6"><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${request.email}</div>
                    <div class="col-md-6"><strong>Ø§Ù„Ù‚Ø³Ù…:</strong> ${request.department}</div>
                </div><hr>
                <div class="row">
                    <div class="col-md-6"><strong>Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨:</strong> ${request.request_type}</div>
                    <div class="col-md-6"><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${request.status}</div>
                </div><hr>
                <div><strong>Ø§Ù„ØªÙØ§ØµÙŠÙ„:</strong></div>
                <div class="border p-2 bg-light">${request.description}</div><hr>
                ${request.notes ? `<div><strong>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong></div><div class="border p-2 bg-info text-white">${request.notes}</div><hr>` : ''}
                <div class="row">
                    <div class="col-md-6"><small><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…:</strong> ${new Date(request.created_at).toLocaleString('ar-SA')}</small></div>
                    <div class="col-md-6"><small><strong>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</strong> ${new Date(request.updated_at).toLocaleString('ar-SA')}</small></div>
                </div>
            `;
            
            var modal = new bootstrap.Modal(document.getElementById('detailsModal'));
            modal.show();
        }
    </script>
</body>
</html>
